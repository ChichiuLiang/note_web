> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/gY7KEptOHksM9Gyxta180g)

> ğŸ‘‰Â **è¿™æ˜¯ä¸€ä¸ªæˆ–è®¸å¯¹ä½ æœ‰ç”¨****çš„ç¤¾ç¾¤**
> 
> ğŸ±Â ä¸€å¯¹ä¸€äº¤æµ / é¢è¯•å°å†Œ / ç®€å†ä¼˜åŒ– / æ±‚èŒè§£æƒ‘ï¼Œæ¬¢è¿åŠ å…¥ã€Œ[**èŠ‹é“å¿«é€Ÿå¼€å‘å¹³å°**](http://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247576697&idx=1&sn=a5f8a37fe0c6f05509c5bed6244471a8&chksm=fa4bd3c8cd3c5aded28a6b68a9944ce671f3d2748644f71550c0468d75058e90dd378a1babe8&scene=21#wechat_redirect)ã€çŸ¥è¯†æ˜Ÿçƒã€‚ä¸‹é¢æ˜¯æ˜Ÿçƒæä¾›çš„éƒ¨åˆ†èµ„æ–™ï¼šÂ 
> 
> *   [ã€Šé¡¹ç›®å®æˆ˜ï¼ˆè§†é¢‘ï¼‰ã€‹](http://mp.weixin.qq.com/s?__biz=MzUxOTc4NjEyMw==&mid=2247561735&idx=1&sn=1b0a95d87fc647c3cf5e2b88576a8f55&chksm=f9f7e9e3ce8060f5809daa189fea465e95fa5445797f96fd8023f424c2acf4d31751a62792fc&scene=21#wechat_redirect)ï¼šä»ä¹¦ä¸­å­¦ï¼Œå¾€äº‹ä¸­ **â€œç»ƒâ€**
>     
> *   [ã€Šäº’è”ç½‘é«˜é¢‘é¢è¯•é¢˜ã€‹](http://mp.weixin.qq.com/s?__biz=MzUxOTc4NjEyMw==&mid=2247561735&idx=1&sn=1b0a95d87fc647c3cf5e2b88576a8f55&chksm=f9f7e9e3ce8060f5809daa189fea465e95fa5445797f96fd8023f424c2acf4d31751a62792fc&scene=21#wechat_redirect)ï¼šé¢æœç®€å†å­¦ä¹ ï¼Œæ˜¥æš–èŠ±å¼€
>     
> *   [ã€Šæ¶æ„ x ç³»ç»Ÿè®¾è®¡ã€‹](http://mp.weixin.qq.com/s?__biz=MzUxOTc4NjEyMw==&mid=2247561735&idx=1&sn=1b0a95d87fc647c3cf5e2b88576a8f55&chksm=f9f7e9e3ce8060f5809daa189fea465e95fa5445797f96fd8023f424c2acf4d31751a62792fc&scene=21#wechat_redirect)ï¼šæ‘§æ¯æ‹‰æœ½ï¼ŒæŒæ§é¢è¯•é«˜é¢‘åœºæ™¯é¢˜
>     
> *   [ã€Šç²¾è¿› Java å­¦ä¹ æŒ‡å—ã€‹](http://mp.weixin.qq.com/s?__biz=MzUxOTc4NjEyMw==&mid=2247561735&idx=1&sn=1b0a95d87fc647c3cf5e2b88576a8f55&chksm=f9f7e9e3ce8060f5809daa189fea465e95fa5445797f96fd8023f424c2acf4d31751a62792fc&scene=21#wechat_redirect)ï¼šç³»ç»Ÿå­¦ä¹ ï¼Œäº’è”ç½‘ä¸»æµæŠ€æœ¯æ ˆ
>     
> *   [ã€Šå¿…è¯» Java æºç ä¸“æ ã€‹](http://mp.weixin.qq.com/s?__biz=MzUxOTc4NjEyMw==&mid=2247561735&idx=1&sn=1b0a95d87fc647c3cf5e2b88576a8f55&chksm=f9f7e9e3ce8060f5809daa189fea465e95fa5445797f96fd8023f424c2acf4d31751a62792fc&scene=21#wechat_redirect)ï¼šçŸ¥å…¶ç„¶ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶
>     

![](https://mmbiz.qpic.cn/mmbiz_gif/JdLkEI9sZfdWPYr0VKaXztEGHacpRyle7tbZkryrsxIpnAfjRt03ibrcloEZqlRPaVKcb0nD2PrYjtovwOAaFlA/640?wx_fmt=gif)

> ğŸ‘‰**è¿™æ˜¯ä¸€ä¸ªæˆ–è®¸å¯¹ä½ æœ‰ç”¨çš„å¼€æºé¡¹ç›®**
> 
> å›½äº§ Star ç ´ 10w+ çš„å¼€æºé¡¹ç›®ï¼Œå‰ç«¯åŒ…æ‹¬ç®¡ç†åå° + å¾®ä¿¡å°ç¨‹åºï¼Œåç«¯æ”¯æŒå•ä½“å’Œå¾®æœåŠ¡æ¶æ„ã€‚
> 
> åŠŸèƒ½æ¶µç›– RBAC æƒé™ã€SaaS å¤šç§Ÿæˆ·ã€æ•°æ®æƒé™ã€å•†åŸã€æ”¯ä»˜ã€å·¥ä½œæµã€å¤§å±æŠ¥è¡¨ã€å¾®ä¿¡å…¬ä¼—å·ç­‰ç­‰åŠŸèƒ½ï¼š
> 
> *   Boot ä»“åº“ï¼šhttps://gitee.com/zhijiantianya/ruoyi-vue-pro
>     
> *   Cloud ä»“åº“ï¼šhttps://gitee.com/zhijiantianya/yudao-cloud
>     
> *   è§†é¢‘æ•™ç¨‹ï¼šhttps://doc.iocoder.cn
>     
> 
> ã€å›½å†…é¦–æ‰¹ã€‘æ”¯æŒ JDK 21Â + SpringBoot 3.2.0ã€JDK 8 + Spring Boot 2.7.18 åŒç‰ˆæœ¬Â 

[æ¥æºï¼šç½‘ç»œ](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

*   [1. ä»‹ç»](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect)
    
*   [2. å‰ç½®çŸ¥è¯†](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect)
    
*   [3. åŠŸèƒ½ä»‹ç»](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect)
    
*   [4. åŠŸèƒ½ç»†èŠ‚](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect)
    
*   [5. ä»£ç å®ç°](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect)
    

[![](https://mmbiz.qpic.cn/mmbiz_jpg/a7wPU9Eqe9u9YZPIAACM2zXnqRYgCdYiaB76hEFyMJBeoZOlURdBzJO88yOFMAv5KSmRb1Ylicsr1YKZIicVkBIKQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect)

* * *

[1. ä»‹ç»](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)
--------------------------------------------------------------------------------------------------------------------------------------------

åœ¨æˆ‘ä»¬æ—¥å¸¸çš„ Java å¼€å‘ä¸­ï¼Œå…ä¸äº†å’Œå…¶ä»–ç³»ç»Ÿçš„ä¸šåŠ¡äº¤äº’ï¼Œæˆ–è€…å¾®æœåŠ¡ä¹‹é—´çš„æ¥å£è°ƒç”¨

å¦‚æœæˆ‘ä»¬æƒ³ä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨ï¼Œå¯¹æ¥å£å‡ºå‚åŠ å¯†ï¼Œå…¥å‚è§£å¯†ã€‚

ä½†æ˜¯ä¸æƒ³å†™é‡å¤ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªé€šç”¨ starterï¼Œæä¾›é€šç”¨åŠ å¯†è§£å¯†åŠŸèƒ½

> åŸºäº Spring Boot + MyBatis Plus + Vue & Element å®ç°çš„åå°ç®¡ç†ç³»ç»Ÿ + ç”¨æˆ·å°ç¨‹åºï¼Œæ”¯æŒ RBAC åŠ¨æ€æƒé™ã€å¤šç§Ÿæˆ·ã€æ•°æ®æƒé™ã€å·¥ä½œæµã€ä¸‰æ–¹ç™»å½•ã€æ”¯ä»˜ã€çŸ­ä¿¡ã€å•†åŸç­‰åŠŸèƒ½
> 
> *   é¡¹ç›®åœ°å€ï¼šhttps://github.com/YunaiV/ruoyi-vue-pro
>     
> *   è§†é¢‘æ•™ç¨‹ï¼šhttps://doc.iocoder.cn/video/
>     

[2. å‰ç½®çŸ¥è¯†](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)
----------------------------------------------------------------------------------------------------------------------------------------------

### [2.1 hutool-crypto åŠ å¯†è§£å¯†å·¥å…·](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

hutool-crypto æä¾›äº†å¾ˆå¤šåŠ å¯†è§£å¯†å·¥å…·ï¼ŒåŒ…æ‹¬å¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†ï¼Œæ‘˜è¦åŠ å¯†ç­‰ç­‰ï¼Œè¿™ä¸åšè¯¦ç»†ä»‹ç»ã€‚

### [2.2 request æµåªèƒ½è¯»å–ä¸€æ¬¡çš„é—®é¢˜](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

#### [2.2.1 é—®é¢˜ï¼š](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

åœ¨æ¥å£è°ƒç”¨é“¾ä¸­ï¼Œrequest çš„è¯·æ±‚æµåªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œå¤„ç†ä¹‹åï¼Œå¦‚æœä¹‹åè¿˜éœ€è¦ç”¨åˆ°è¯·æ±‚æµè·å–æ•°æ®ï¼Œå°±ä¼šå‘ç°æ•°æ®ä¸ºç©ºã€‚

æ¯”å¦‚ä½¿ç”¨äº† filter æˆ–è€… aop åœ¨æ¥å£å¤„ç†ä¹‹å‰ï¼Œè·å–äº† request ä¸­çš„æ•°æ®ï¼Œå¯¹å‚æ•°è¿›è¡Œäº†æ ¡éªŒï¼Œé‚£ä¹ˆä¹‹åå°±ä¸èƒ½åœ¨è·å– request è¯·æ±‚æµäº†

#### [2.2.2 è§£å†³åŠæ³•](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

ç»§æ‰¿`HttpServletRequestWrapper`ï¼Œå°†è¯·æ±‚ä¸­çš„æµ copy ä¸€ä»½ï¼Œå¤å†™`getInputStream`å’Œ getReader æ–¹æ³•ä¾›å¤–éƒ¨ä½¿ç”¨ã€‚æ¯æ¬¡è°ƒç”¨åçš„`getInputStream`æ–¹æ³•éƒ½æ˜¯ä»å¤åˆ¶å‡ºæ¥çš„äºŒè¿›åˆ¶æ•°ç»„ä¸­è¿›è¡Œè·å–ï¼Œè¿™ä¸ªäºŒè¿›åˆ¶æ•°ç»„åœ¨å¯¹è±¡å­˜åœ¨æœŸé—´ä¸€è‡´å­˜åœ¨ã€‚

ä½¿ç”¨ Filter è¿‡æ»¤å™¨ï¼Œåœ¨ä¸€å¼€å§‹ï¼Œæ›¿æ¢ request ä¸ºè‡ªå·±å®šä¹‰çš„å¯ä»¥å¤šæ¬¡è¯»å–æµçš„ requestã€‚

è¿™æ ·å°±å®ç°äº†æµçš„é‡å¤è·å–

`InputStreamHttpServletRequestWrapper`

```
packageÂ xyz.hlh.cryptotest.utils;importÂ org.apache.commons.io.IOUtils;importÂ javax.servlet.ReadListener;importÂ javax.servlet.ServletInputStream;importÂ javax.servlet.http.HttpServletRequest;importÂ javax.servlet.http.HttpServletRequestWrapper;importÂ java.io.BufferedReader;importÂ java.io.ByteArrayInputStream;importÂ java.io.ByteArrayOutputStream;importÂ java.io.IOException;importÂ java.io.InputStreamReader;/**Â *Â è¯·æ±‚æµæ”¯æŒå¤šæ¬¡è·å–Â */publicÂ classÂ InputStreamHttpServletRequestWrapperÂ extendsÂ HttpServletRequestWrapperÂ {Â Â Â Â /**Â Â Â Â Â *Â ç”¨äºç¼“å­˜è¾“å…¥æµÂ Â Â Â Â */Â Â Â Â privateÂ ByteArrayOutputStreamÂ cachedBytes;Â Â Â Â publicÂ InputStreamHttpServletRequestWrapper(HttpServletRequestÂ request)Â {Â Â Â Â Â Â Â Â super(request);Â Â Â Â }Â Â Â Â @OverrideÂ Â Â Â publicÂ ServletInputStreamÂ getInputStream()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â ifÂ (cachedBytesÂ ==Â null)Â {Â Â Â Â Â Â Â Â Â Â Â Â //Â é¦–æ¬¡è·å–æµæ—¶ï¼Œå°†æµæ”¾å…¥Â ç¼“å­˜è¾“å…¥æµÂ ä¸­Â Â Â Â Â Â Â Â Â Â Â Â cacheInputStream();Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â //Â ä»Â ç¼“å­˜è¾“å…¥æµÂ ä¸­è·å–æµå¹¶è¿”å›Â Â Â Â Â Â Â Â returnÂ newÂ CachedServletInputStream(cachedBytes.toByteArray());Â Â Â Â }Â Â Â Â @OverrideÂ Â Â Â publicÂ BufferedReaderÂ getReader()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â returnÂ newÂ BufferedReader(newÂ InputStreamReader(getInputStream()));Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â é¦–æ¬¡è·å–æµæ—¶ï¼Œå°†æµæ”¾å…¥Â ç¼“å­˜è¾“å…¥æµÂ ä¸­Â Â Â Â Â */Â Â Â Â privateÂ voidÂ cacheInputStream()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //Â ç¼“å­˜è¾“å…¥æµä»¥ä¾¿å¤šæ¬¡è¯»å–ã€‚ä¸ºäº†æ–¹ä¾¿, æˆ‘ä½¿ç”¨ org.apache.commons IOUtilsÂ Â Â Â Â Â Â Â cachedBytesÂ =Â newÂ ByteArrayOutputStream();Â Â Â Â Â Â Â Â IOUtils.copy(super.getInputStream(),Â cachedBytes);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â è¯»å–ç¼“å­˜çš„è¯·æ±‚æ­£æ–‡çš„è¾“å…¥æµÂ Â Â Â Â *Â <p>Â Â Â Â Â *Â ç”¨äºæ ¹æ®Â ç¼“å­˜è¾“å…¥æµÂ åˆ›å»ºä¸€ä¸ªå¯è¿”å›çš„Â Â Â Â Â */Â Â Â Â publicÂ staticÂ classÂ CachedServletInputStreamÂ extendsÂ ServletInputStreamÂ {Â Â Â Â Â Â Â Â privateÂ finalÂ ByteArrayInputStreamÂ input;Â Â Â Â Â Â Â Â publicÂ CachedServletInputStream(byte[]Â buf)Â {Â Â Â Â Â Â Â Â Â Â Â Â //Â ä»ç¼“å­˜çš„è¯·æ±‚æ­£æ–‡åˆ›å»ºä¸€ä¸ªæ–°çš„è¾“å…¥æµÂ Â Â Â Â Â Â Â Â Â Â Â inputÂ =Â newÂ ByteArrayInputStream(buf);Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â @OverrideÂ Â Â Â Â Â Â Â publicÂ booleanÂ isFinished()Â {Â Â Â Â Â Â Â Â Â Â Â Â returnÂ false;Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â @OverrideÂ Â Â Â Â Â Â Â publicÂ booleanÂ isReady()Â {Â Â Â Â Â Â Â Â Â Â Â Â returnÂ false;Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â @OverrideÂ Â Â Â Â Â Â Â publicÂ voidÂ setReadListener(ReadListenerÂ listener)Â {Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â @OverrideÂ Â Â Â Â Â Â Â publicÂ intÂ read()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â Â Â Â Â returnÂ input.read();Â Â Â Â Â Â Â Â }Â Â Â Â }}
```

`HttpServletRequestInputStreamFilter`

```
packageÂ xyz.hlh.cryptotest.filter;importÂ org.springframework.core.annotation.Order;importÂ org.springframework.stereotype.Component;importÂ xyz.hlh.cryptotest.utils.InputStreamHttpServletRequestWrapper;importÂ javax.servlet.Filter;importÂ javax.servlet.FilterChain;importÂ javax.servlet.ServletException;importÂ javax.servlet.ServletRequest;importÂ javax.servlet.ServletResponse;importÂ javax.servlet.http.HttpServletRequest;importÂ java.io.IOException;importÂ staticÂ org.springframework.core.Ordered.HIGHEST_PRECEDENCE;/**Â *Â @authorÂ HLHÂ *Â @description:Â *Â Â Â Â Â Â è¯·æ±‚æµè½¬æ¢ä¸ºå¤šæ¬¡è¯»å–çš„è¯·æ±‚æµÂ è¿‡æ»¤å™¨Â *Â @emailÂ 17703595860@163.comÂ *Â @dateÂ :Â CreatedÂ inÂ 2022/2/4Â 9:58Â */@Component@Order(HIGHEST_PRECEDENCEÂ +Â 1)Â Â //Â ä¼˜å…ˆçº§æœ€é«˜publicÂ classÂ HttpServletRequestInputStreamFilterÂ implementsÂ FilterÂ {Â Â Â Â @OverrideÂ Â Â Â publicÂ voidÂ doFilter(ServletRequestÂ request,Â ServletResponseÂ response,Â FilterChainÂ chain)Â throwsÂ IOException,Â ServletExceptionÂ {Â Â Â Â Â Â Â Â //Â è½¬æ¢ä¸ºå¯ä»¥å¤šæ¬¡è·å–æµçš„requestÂ Â Â Â Â Â Â Â HttpServletRequestÂ httpServletRequestÂ =Â (HttpServletRequest)Â request;Â Â Â Â Â Â Â Â InputStreamHttpServletRequestWrapperÂ inputStreamHttpServletRequestWrapperÂ =Â newÂ InputStreamHttpServletRequestWrapper(httpServletRequest);Â Â Â Â Â Â Â Â //Â æ”¾è¡ŒÂ Â Â Â Â Â Â Â chain.doFilter(inputStreamHttpServletRequestWrapper,Â response);Â Â Â Â }}
```

### [2.3 SpringBoot çš„å‚æ•°æ ¡éªŒ validation](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

ä¸ºäº†å‡å°‘æ¥å£ä¸­ï¼Œä¸šåŠ¡ä»£ç ä¹‹å‰çš„å¤§é‡å†—ä½™çš„å‚æ•°æ ¡éªŒä»£ç 

`SpringBoot-validation`æä¾›äº†ä¼˜é›…çš„å‚æ•°æ ¡éªŒï¼Œå…¥å‚éƒ½æ˜¯å®ä½“ç±»ï¼Œåœ¨å®ä½“ç±»å­—æ®µä¸ŠåŠ ä¸Šå¯¹åº”æ³¨è§£ï¼Œå°±å¯ä»¥åœ¨è¿›å…¥æ–¹æ³•ä¹‹å‰ï¼Œè¿›è¡Œå‚æ•°æ ¡éªŒï¼Œå¦‚æœå‚æ•°é”™è¯¯ï¼Œä¼šæŠ›å‡ºé”™è¯¯`BindException`ï¼Œæ˜¯ä¸ä¼šè¿›å…¥æ–¹æ³•çš„ã€‚

è¿™ç§æ–¹æ³•ï¼Œå¿…é¡»è¦æ±‚åœ¨æ¥å£å‚æ•°ä¸ŠåŠ æ³¨è§£`@Validated`æˆ–è€…æ˜¯`@Valid`

ä½†æ˜¯å¾ˆå¤šæ¸…ç©ºä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ä»£ç ä¸­è°ƒç”¨æŸä¸ªå®ä½“ç±»çš„æ ¡éªŒåŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦å¦‚ä¸‹å·¥å…·ç±»

`ParamException`

```
packageÂ xyz.hlh.cryptotest.exception;importÂ lombok.Getter;importÂ java.util.List;/**Â *Â @authorÂ HLHÂ *Â @descriptionÂ è‡ªå®šä¹‰å‚æ•°å¼‚å¸¸Â *Â @emailÂ 17703595860@163.comÂ *Â @dateÂ CreatedÂ inÂ 2021/8/10Â ä¸‹åˆ10:56Â */@GetterpublicÂ classÂ ParamExceptionÂ extendsÂ ExceptionÂ {Â Â Â Â privateÂ finalÂ List<String>Â fieldList;Â Â Â Â privateÂ finalÂ List<String>Â msgList;Â Â Â Â publicÂ ParamException(List<String>Â fieldList,Â List<String>Â msgList)Â {Â Â Â Â Â Â Â Â this.fieldListÂ =Â fieldList;Â Â Â Â Â Â Â Â this.msgListÂ =Â msgList;Â Â Â Â }}
```

`ValidationUtils`

```
packageÂ xyz.hlh.cryptotest.utils;importÂ xyz.hlh.cryptotest.exception.CustomizeException;importÂ xyz.hlh.cryptotest.exception.ParamException;importÂ javax.validation.ConstraintViolation;importÂ javax.validation.Validation;importÂ javax.validation.Validator;importÂ java.util.LinkedList;importÂ java.util.List;importÂ java.util.Set;/**Â *Â @authorÂ HLHÂ *Â @descriptionÂ éªŒè¯å·¥å…·ç±»Â *Â @emailÂ 17703595860@163.comÂ *Â @dateÂ CreatedÂ inÂ 2021/8/10Â ä¸‹åˆ10:56Â */publicÂ classÂ ValidationUtilsÂ {Â Â Â Â privateÂ staticÂ finalÂ ValidatorÂ VALIDATORÂ =Â Validation.buildDefaultValidatorFactory().getValidator();Â Â Â Â /**Â Â Â Â Â *Â éªŒè¯æ•°æ®Â Â Â Â Â *Â @paramÂ objectÂ æ•°æ®Â Â Â Â Â */Â Â Â Â publicÂ staticÂ voidÂ validate(ObjectÂ object)Â throwsÂ CustomizeExceptionÂ {Â Â Â Â Â Â Â Â Set<ConstraintViolation<Object>>Â validateÂ =Â VALIDATOR.validate(object);Â Â Â Â Â Â Â Â //Â éªŒè¯ç»“æœå¼‚å¸¸Â Â Â Â Â Â Â Â throwParamException(validate);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â éªŒè¯æ•°æ®(åˆ†ç»„)Â Â Â Â Â *Â @paramÂ objectÂ æ•°æ®Â Â Â Â Â *Â @paramÂ groupsÂ æ‰€åœ¨ç»„Â Â Â Â Â */Â Â Â Â publicÂ staticÂ voidÂ validate(ObjectÂ object,Â Class<?>Â ...Â groups)Â throwsÂ CustomizeExceptionÂ {Â Â Â Â Â Â Â Â Set<ConstraintViolation<Object>>Â validateÂ =Â VALIDATOR.validate(object,Â groups);Â Â Â Â Â Â Â Â //Â éªŒè¯ç»“æœå¼‚å¸¸Â Â Â Â Â Â Â Â throwParamException(validate);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â éªŒè¯æ•°æ®ä¸­çš„æŸä¸ªå­—æ®µ(åˆ†ç»„)Â Â Â Â Â *Â @paramÂ objectÂ æ•°æ®Â Â Â Â Â *Â @paramÂ propertyNameÂ å­—æ®µåç§°Â Â Â Â Â */Â Â Â Â publicÂ staticÂ voidÂ validate(ObjectÂ object,Â StringÂ propertyName)Â throwsÂ CustomizeExceptionÂ {Â Â Â Â Â Â Â Â Set<ConstraintViolation<Object>>Â validateÂ =Â VALIDATOR.validateProperty(object,Â propertyName);Â Â Â Â Â Â Â Â //Â éªŒè¯ç»“æœå¼‚å¸¸Â Â Â Â Â Â Â Â throwParamException(validate);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â éªŒè¯æ•°æ®ä¸­çš„æŸä¸ªå­—æ®µ(åˆ†ç»„)Â Â Â Â Â *Â @paramÂ objectÂ æ•°æ®Â Â Â Â Â *Â @paramÂ propertyNameÂ å­—æ®µåç§°Â Â Â Â Â *Â @paramÂ groupsÂ æ‰€åœ¨ç»„Â Â Â Â Â */Â Â Â Â publicÂ staticÂ voidÂ validate(ObjectÂ object,Â StringÂ propertyName,Â Class<?>Â ...Â groups)Â throwsÂ CustomizeExceptionÂ {Â Â Â Â Â Â Â Â Set<ConstraintViolation<Object>>Â validateÂ =Â VALIDATOR.validateProperty(object,Â propertyName,Â groups);Â Â Â Â Â Â Â Â //Â éªŒè¯ç»“æœå¼‚å¸¸Â Â Â Â Â Â Â Â throwParamException(validate);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â éªŒè¯ç»“æœå¼‚å¸¸Â Â Â Â Â *Â @paramÂ validateÂ éªŒè¯ç»“æœÂ Â Â Â Â */Â Â Â Â privateÂ staticÂ voidÂ throwParamException(Set<ConstraintViolation<Object>>Â validate)Â throwsÂ CustomizeExceptionÂ {Â Â Â Â Â Â Â Â ifÂ (validate.size()Â >Â 0)Â {Â Â Â Â Â Â Â Â Â Â Â Â List<String>Â fieldListÂ =Â newÂ LinkedList<>();Â Â Â Â Â Â Â Â Â Â Â Â List<String>Â msgListÂ =Â newÂ LinkedList<>();Â Â Â Â Â Â Â Â Â Â Â Â forÂ (ConstraintViolation<Object>Â nextÂ :Â validate)Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â fieldList.add(next.getPropertyPath().toString());Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â msgList.add(next.getMessage());Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â Â Â Â Â throwÂ newÂ ParamException(fieldList,Â msgList);Â Â Â Â Â Â Â Â }Â Â Â Â }}
```

### [2.4 è‡ªå®šä¹‰ starter](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

è‡ªå®šä¹‰ starter æ­¥éª¤

*   åˆ›å»ºå·¥å‚ï¼Œç¼–å†™åŠŸèƒ½ä»£ç 
    
*   å£°æ˜è‡ªåŠ¨é…ç½®ç±»ï¼ŒæŠŠéœ€è¦å¯¹å¤–æä¾›çš„å¯¹è±¡åˆ›å»ºå¥½ï¼Œé€šè¿‡é…ç½®ç±»ç»Ÿä¸€å‘å¤–æš´éœ²
    
*   åœ¨ resource ç›®å½•ä¸‹å‡†å¤‡ä¸€ä¸ªåä¸º`spring/spring.factories`çš„æ–‡ä»¶ï¼Œä»¥`org.springframework.boot.autoconfigure.EnableAutoConfiguration`ä¸º keyï¼Œè‡ªåŠ¨é…ç½®ç±»ä¸º value åˆ—è¡¨ï¼Œè¿›è¡Œæ³¨å†Œ
    

### [2.5 RequestBodyAdvice å’Œ ResponseBodyAdvice](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

*   `RequestBodyAdvice`æ˜¯å¯¹è¯·æ±‚çš„ json ä¸²è¿›è¡Œå¤„ç†ï¼Œ ä¸€èˆ¬ä½¿ç”¨ç¯å¢ƒæ˜¯å¤„ç†æ¥å£å‚æ•°çš„è‡ªåŠ¨è§£å¯†
    
*   `ResponseBodyAdvice`æ˜¯å¯¹è¯·æ±‚ç›¸åº”çš„ jsoin ä¼ è¿›è¡Œå¤„ç†ï¼Œä¸€èˆ¬ç”¨äºç›¸åº”ç»“æœçš„åŠ å¯†
    

> åŸºäº Spring Cloud Alibaba + Gateway + Nacos + RocketMQ + Vue & Element å®ç°çš„åå°ç®¡ç†ç³»ç»Ÿ + ç”¨æˆ·å°ç¨‹åºï¼Œæ”¯æŒ RBAC åŠ¨æ€æƒé™ã€å¤šç§Ÿæˆ·ã€æ•°æ®æƒé™ã€å·¥ä½œæµã€ä¸‰æ–¹ç™»å½•ã€æ”¯ä»˜ã€çŸ­ä¿¡ã€å•†åŸç­‰åŠŸèƒ½
> 
> *   é¡¹ç›®åœ°å€ï¼šhttps://github.com/YunaiV/yudao-cloud
>     
> *   è§†é¢‘æ•™ç¨‹ï¼šhttps://doc.iocoder.cn/video/
>     

[3. åŠŸèƒ½ä»‹ç»](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)
----------------------------------------------------------------------------------------------------------------------------------------------

æ¥å£ç›¸åº”æ•°æ®çš„æ—¶å€™ï¼Œè¿”å›çš„æ˜¯åŠ å¯†ä¹‹åçš„æ•°æ® æ¥å£å…¥å‚çš„æ—¶å€™ï¼Œæ¥æ”¶çš„æ˜¯è§£å¯†ä¹‹åçš„æ•°æ®ï¼Œä½†æ˜¯åœ¨è¿›å…¥æ¥å£ä¹‹å‰ï¼Œä¼šè‡ªåŠ¨è§£å¯†ï¼Œå–å¾—å¯¹åº”çš„æ•°æ®

[4. åŠŸèƒ½ç»†èŠ‚](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)
----------------------------------------------------------------------------------------------------------------------------------------------

åŠ å¯†è§£å¯†ä½¿ç”¨å¯¹ç§°åŠ å¯†çš„ AES ç®—æ³•ï¼Œä½¿ç”¨ hutool-crypto æ¨¡å—è¿›è¡Œå®ç°

æ‰€æœ‰çš„å®ä½“ç±»æå–ä¸€ä¸ªå…¬å…±çˆ¶ç±»ï¼ŒåŒ…å«å±æ€§æ—¶é—´æˆ³ï¼Œç”¨äºåŠ å¯†æ•°æ®è¿”å›ä¹‹åçš„å®æ•ˆæ€§ï¼Œå¦‚æœè¶…è¿‡ 60 åˆ†é’Ÿï¼Œé‚£ä¹ˆå…¶ä»–æ¥å£å°†ä¸è¿›è¡Œå¤„ç†ã€‚

å¦‚æœæ¥å£åŠ äº†åŠ å¯†æ³¨è§£`EncryptionAnnotation`ï¼Œå¹¶ä¸”è¿”å›ç»Ÿä¸€çš„ json æ•°æ® Result ç±»ï¼Œåˆ™è‡ªåŠ¨å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚å¦‚æœæ˜¯ç»§æ‰¿äº†ç»Ÿä¸€çˆ¶ç±»`RequestBase`çš„æ•°æ®ï¼Œè‡ªåŠ¨æ³¨å…¥æ—¶é—´æˆ³ï¼Œç¡®ä¿æ•°æ®çš„æ—¶æ•ˆæ€§

å¦‚æœæ¥å£åŠ äº†è§£å¯†æ³¨è§£`DecryptionAnnotation`ï¼Œå¹¶ä¸”å‚æ•°ä½¿ç”¨ RequestBody æ³¨è§£æ ‡æ³¨ï¼Œä¼ å…¥ json ä½¿ç”¨ç»Ÿä¸€æ ¼å¼ RequestData ç±»ï¼Œå¹¶ä¸”å†…å®¹æ˜¯ç»§æ‰¿äº†åŒ…å«æ—¶é—´é•¿çš„çˆ¶ç±»`RequestBase`ï¼Œåˆ™è‡ªåŠ¨è§£å¯†ï¼Œå¹¶ä¸”è½¬ä¸ºå¯¹åº”çš„æ•°æ®ç±»å‹

åŠŸèƒ½æä¾› Springboot çš„ starterï¼Œå®ç°å¼€ç®±å³ç”¨

[5. ä»£ç å®ç°](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)
----------------------------------------------------------------------------------------------------------------------------------------------

> https://gitee.com/springboot-hlh/spring-boot-csdn/tree/master/09-spring-boot-interface-crypto

### [5.1 é¡¹ç›®ç»“æ„](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_png/6mychickmupVtnUCQDopBzY25pc0E8ge6sqoW4Mg2Rr73ib4VgZFUGUiakliaI4jGN1NtW0ibjMqy6b90W8v26LLOcQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

### [5.2 crypto-common](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

#### [5.2.1 ç»“æ„](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_png/6mychickmupVtnUCQDopBzY25pc0E8ge6Yic79W5mcbgQRgqeF9opMagicx6IsdKURm7nDGBTfIUeAgrj9Va8G9qw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

### [5.3 crypto-spring-boot-starter](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

#### [5.3.1 æ¥å£](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_png/6mychickmupVtnUCQDopBzY25pc0E8ge6BQxf2N7LOwaP3Nhrv9cGGq3M7H9ia5ZHVHibdawOpO2ZMCawPh9nyW9A/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

#### [5.3.2 é‡è¦ä»£ç ](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

crypto.properties AES éœ€è¦çš„å‚æ•°é…ç½®

```
#Â æ¨¡å¼Â Â Â Â cn.hutool.crypto.Mode<br style="outline: 0px;">crypto.mode=CTS<br style="outline: 0px;">#Â è¡¥ç æ–¹å¼Â cn.hutool.crypto.Mode<br style="outline: 0px;">crypto.padding=PKCS5Padding<br style="outline: 0px;">#Â ç§˜é’¥<br style="outline: 0px;">crypto.key=testkey123456789<br style="outline: 0px;">#Â ç›<br style="outline: 0px;">crypto.iv=testiv1234567890<br style="outline: 0px;">
```

spring.factories è‡ªåŠ¨é…ç½®æ–‡ä»¶

```
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\<br style="outline: 0px;">xyz.hlh.crypto.config.AppConfig<br style="outline: 0px;">
```

CryptConfig AES éœ€è¦çš„é…ç½®å‚æ•°

```
packageÂ xyz.hlh.crypto.config;importÂ cn.hutool.crypto.Mode;importÂ cn.hutool.crypto.Padding;importÂ lombok.Data;importÂ lombok.EqualsAndHashCode;importÂ lombok.Getter;importÂ org.springframework.boot.context.properties.ConfigurationProperties;importÂ org.springframework.context.annotation.Configuration;importÂ org.springframework.context.annotation.PropertySource;importÂ java.io.Serializable;/**Â *Â @authorÂ HLHÂ *Â @description:Â AESéœ€è¦çš„é…ç½®å‚æ•°Â *Â @emailÂ 17703595860@163.comÂ *Â @dateÂ :Â CreatedÂ inÂ 2022/2/4Â 13:16Â */@Configuration@ConfigurationProperties(prefixÂ =Â "crypto")@PropertySource("classpath:crypto.properties")@Data@EqualsAndHashCode@GetterpublicÂ classÂ CryptConfigÂ implementsÂ SerializableÂ {Â Â Â Â privateÂ ModeÂ mode;Â Â Â Â privateÂ PaddingÂ padding;Â Â Â Â privateÂ StringÂ key;Â Â Â Â privateÂ StringÂ iv;}
```

AppConfig è‡ªåŠ¨é…ç½®ç±»

```
packageÂ xyz.hlh.crypto.config;importÂ cn.hutool.crypto.symmetric.AES;importÂ org.springframework.context.annotation.Bean;importÂ org.springframework.context.annotation.Configuration;importÂ javax.annotation.Resource;importÂ java.nio.charset.StandardCharsets;/**Â *Â @authorÂ HLHÂ *Â @description:Â è‡ªåŠ¨é…ç½®ç±»Â *Â @emailÂ 17703595860@163.comÂ *Â @dateÂ :Â CreatedÂ inÂ 2022/2/4Â 13:12Â */@ConfigurationpublicÂ classÂ AppConfigÂ {Â Â Â Â @ResourceÂ Â Â Â privateÂ CryptConfigÂ cryptConfig;Â Â Â Â @BeanÂ Â Â Â publicÂ AESÂ aes()Â {Â Â Â Â Â Â Â Â returnÂ newÂ AES(cryptConfig.getMode(),Â cryptConfig.getPadding(),Â cryptConfig.getKey().getBytes(StandardCharsets.UTF_8),Â cryptConfig.getIv().getBytes(StandardCharsets.UTF_8));Â Â Â Â }}
```

`DecryptRequestBodyAdvice`Â è¯·æ±‚è‡ªåŠ¨è§£å¯†

```
packageÂ xyz.hlh.crypto.advice;importÂ com.fasterxml.jackson.databind.ObjectMapper;importÂ lombok.SneakyThrows;importÂ org.apache.commons.lang3.StringUtils;importÂ org.springframework.beans.factory.annotation.Autowired;importÂ org.springframework.core.MethodParameter;importÂ org.springframework.http.HttpInputMessage;importÂ org.springframework.http.converter.HttpMessageConverter;importÂ org.springframework.web.bind.annotation.ControllerAdvice;importÂ org.springframework.web.context.request.RequestAttributes;importÂ org.springframework.web.context.request.RequestContextHolder;importÂ org.springframework.web.context.request.ServletRequestAttributes;importÂ org.springframework.web.servlet.mvc.method.annotation.RequestBodyAdvice;importÂ xyz.hlh.crypto.annotation.DecryptionAnnotation;importÂ xyz.hlh.crypto.common.exception.ParamException;importÂ xyz.hlh.crypto.constant.CryptoConstant;importÂ xyz.hlh.crypto.entity.RequestBase;importÂ xyz.hlh.crypto.entity.RequestData;importÂ xyz.hlh.crypto.util.AESUtil;importÂ javax.servlet.ServletInputStream;importÂ javax.servlet.http.HttpServletRequest;importÂ java.io.IOException;importÂ java.lang.reflect.Type;/**Â *Â @authorÂ HLHÂ *Â @description:Â requestBodyÂ è‡ªåŠ¨è§£å¯†Â *Â @emailÂ 17703595860@163.comÂ *Â @dateÂ :Â CreatedÂ inÂ 2022/2/4Â 15:12Â */@ControllerAdvicepublicÂ classÂ DecryptRequestBodyAdviceÂ implementsÂ RequestBodyAdviceÂ {Â Â Â Â @AutowiredÂ Â Â Â privateÂ ObjectMapperÂ objectMapper;Â Â Â Â /**Â Â Â Â Â *Â æ–¹æ³•ä¸Šæœ‰DecryptionAnnotationæ³¨è§£çš„ï¼Œè¿›å…¥æ­¤æ‹¦æˆªå™¨Â Â Â Â Â *Â @paramÂ methodParameterÂ æ–¹æ³•å‚æ•°å¯¹è±¡Â Â Â Â Â *Â @paramÂ targetTypeÂ å‚æ•°çš„ç±»å‹Â Â Â Â Â *Â @paramÂ converterTypeÂ æ¶ˆæ¯è½¬æ¢å™¨Â Â Â Â Â *Â @returnÂ trueï¼Œè¿›å…¥ï¼Œfalseï¼Œè·³è¿‡Â Â Â Â Â */Â Â Â Â @OverrideÂ Â Â Â publicÂ booleanÂ supports(MethodParameterÂ methodParameter,Â TypeÂ targetType,Â Class<?Â extendsÂ HttpMessageConverter<?>>Â converterType)Â {Â Â Â Â Â Â Â Â returnÂ methodParameter.hasMethodAnnotation(DecryptionAnnotation.class);Â Â Â Â }Â Â Â Â @OverrideÂ Â Â Â publicÂ HttpInputMessageÂ beforeBodyRead(HttpInputMessageÂ inputMessage,Â MethodParameterÂ parameter,Â TypeÂ targetType,Â Class<?Â extendsÂ HttpMessageConverter<?>>Â converterType)Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â returnÂ inputMessage;Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â è½¬æ¢ä¹‹åï¼Œæ‰§è¡Œæ­¤æ–¹æ³•ï¼Œè§£å¯†ï¼Œèµ‹å€¼Â Â Â Â Â *Â @paramÂ bodyÂ springè§£æå®Œçš„å‚æ•°Â Â Â Â Â *Â @paramÂ inputMessageÂ è¾“å…¥å‚æ•°Â Â Â Â Â *Â @paramÂ parameterÂ å‚æ•°å¯¹è±¡Â Â Â Â Â *Â @paramÂ targetTypeÂ å‚æ•°ç±»å‹Â Â Â Â Â *Â @paramÂ converterTypeÂ æ¶ˆæ¯è½¬æ¢ç±»å‹Â Â Â Â Â *Â @returnÂ çœŸå®çš„å‚æ•°Â Â Â Â Â */Â Â Â Â @SneakyThrowsÂ Â Â Â @OverrideÂ Â Â Â publicÂ ObjectÂ afterBodyRead(ObjectÂ body,Â HttpInputMessageÂ inputMessage,Â MethodParameterÂ parameter,Â TypeÂ targetType,Â Class<?Â extendsÂ HttpMessageConverter<?>>Â converterType)Â {Â Â Â Â Â Â Â Â //Â è·å–requestÂ Â Â Â Â Â Â Â RequestAttributesÂ requestAttributesÂ =Â RequestContextHolder.getRequestAttributes();Â Â Â Â Â Â Â Â ServletRequestAttributesÂ servletRequestAttributesÂ =Â (ServletRequestAttributes)Â requestAttributes;Â Â Â Â Â Â Â Â ifÂ (servletRequestAttributesÂ ==Â null)Â {Â Â Â Â Â Â Â Â Â Â Â Â throwÂ newÂ ParamException("requesté”™è¯¯");Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â HttpServletRequestÂ requestÂ =Â servletRequestAttributes.getRequest();Â Â Â Â Â Â Â Â //Â è·å–æ•°æ®Â Â Â Â Â Â Â Â ServletInputStreamÂ inputStreamÂ =Â request.getInputStream();Â Â Â Â Â Â Â Â RequestDataÂ requestDataÂ =Â objectMapper.readValue(inputStream,Â RequestData.class);Â Â Â Â Â Â Â Â ifÂ (requestDataÂ ==Â nullÂ ||Â StringUtils.isBlank(requestData.getText()))Â {Â Â Â Â Â Â Â Â Â Â Â Â throwÂ newÂ ParamException("å‚æ•°é”™è¯¯");Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â //Â è·å–åŠ å¯†çš„æ•°æ®Â Â Â Â Â Â Â Â StringÂ textÂ =Â requestData.getText();Â Â Â Â Â Â Â Â //Â æ”¾å…¥è§£å¯†ä¹‹å‰çš„æ•°æ®Â Â Â Â Â Â Â Â request.setAttribute(CryptoConstant.INPUT_ORIGINAL_DATA,Â text);Â Â Â Â Â Â Â Â //Â è§£å¯†Â Â Â Â Â Â Â Â StringÂ decryptTextÂ =Â null;Â Â Â Â Â Â Â Â tryÂ {Â Â Â Â Â Â Â Â Â Â Â Â decryptTextÂ =Â AESUtil.decrypt(text);Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â {Â Â Â Â Â Â Â Â Â Â Â Â throwÂ newÂ ParamException("è§£å¯†å¤±è´¥");Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â ifÂ (StringUtils.isBlank(decryptText))Â {Â Â Â Â Â Â Â Â Â Â Â Â throwÂ newÂ ParamException("è§£å¯†å¤±è´¥");Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â //Â æ”¾å…¥è§£å¯†ä¹‹åçš„æ•°æ®Â Â Â Â Â Â Â Â request.setAttribute(CryptoConstant.INPUT_DECRYPT_DATA,Â decryptText);Â Â Â Â Â Â Â Â //Â è·å–ç»“æœÂ Â Â Â Â Â Â Â ObjectÂ resultÂ =Â objectMapper.readValue(decryptText,Â body.getClass());Â Â Â Â Â Â Â Â //Â å¼ºåˆ¶æ‰€æœ‰å®ä½“ç±»å¿…é¡»ç»§æ‰¿RequestBaseç±»ï¼Œè®¾ç½®æ—¶é—´æˆ³Â Â Â Â Â Â Â Â ifÂ (resultÂ instanceofÂ RequestBase)Â {Â Â Â Â Â Â Â Â Â Â Â Â //Â è·å–æ—¶é—´æˆ³Â Â Â Â Â Â Â Â Â Â Â Â LongÂ currentTimeMillisÂ =Â ((RequestBase)Â result).getCurrentTimeMillis();Â Â Â Â Â Â Â Â Â Â Â Â //Â æœ‰æ•ˆæœŸÂ 60ç§’Â Â Â Â Â Â Â Â Â Â Â Â longÂ effectiveÂ =Â 60*1000;Â Â Â Â Â Â Â Â Â Â Â Â //Â æ—¶é—´å·®Â Â Â Â Â Â Â Â Â Â Â Â longÂ expireÂ =Â System.currentTimeMillis()Â -Â currentTimeMillis;Â Â Â Â Â Â Â Â Â Â Â Â //Â æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (Math.abs(expire)Â >Â effective)Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â throwÂ newÂ ParamException("æ—¶é—´æˆ³ä¸åˆæ³•");Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â Â Â Â Â //Â è¿”å›è§£å¯†ä¹‹åçš„æ•°æ®Â Â Â Â Â Â Â Â Â Â Â Â returnÂ result;Â Â Â Â Â Â Â Â }Â elseÂ {Â Â Â Â Â Â Â Â Â Â Â Â throwÂ newÂ ParamException(String.format("è¯·æ±‚å‚æ•°ç±»å‹ï¼š%s æœªç»§æ‰¿ï¼š%s",Â result.getClass().getName(),Â RequestBase.class.getName()));Â Â Â Â Â Â Â Â }Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â å¦‚æœbodyä¸ºç©ºï¼Œè½¬ä¸ºç©ºå¯¹è±¡Â Â Â Â Â *Â @paramÂ bodyÂ springè§£æå®Œçš„å‚æ•°Â Â Â Â Â *Â @paramÂ inputMessageÂ è¾“å…¥å‚æ•°Â Â Â Â Â *Â @paramÂ parameterÂ å‚æ•°å¯¹è±¡Â Â Â Â Â *Â @paramÂ targetTypeÂ å‚æ•°ç±»å‹Â Â Â Â Â *Â @paramÂ converterTypeÂ æ¶ˆæ¯è½¬æ¢ç±»å‹Â Â Â Â Â *Â @returnÂ çœŸå®çš„å‚æ•°Â Â Â Â Â */Â Â Â Â @SneakyThrowsÂ Â Â Â @OverrideÂ Â Â Â publicÂ ObjectÂ handleEmptyBody(ObjectÂ body,Â HttpInputMessageÂ inputMessage,Â MethodParameterÂ parameter,Â TypeÂ targetType,Â Class<?Â extendsÂ HttpMessageConverter<?>>Â converterType)Â {Â Â Â Â Â Â Â Â StringÂ typeNameÂ =Â targetType.getTypeName();Â Â Â Â Â Â Â Â Class<?>Â bodyClassÂ =Â Class.forName(typeName);Â Â Â Â Â Â Â Â returnÂ bodyClass.newInstance();Â Â Â Â }}
```

`EncryptResponseBodyAdvice`Â ç›¸åº”è‡ªåŠ¨åŠ å¯†

```
packageÂ xyz.hlh.crypto.advice;importÂ cn.hutool.json.JSONUtil;importÂ com.fasterxml.jackson.databind.ObjectMapper;importÂ lombok.SneakyThrows;importÂ org.apache.commons.lang3.StringUtils;importÂ org.springframework.beans.factory.annotation.Autowired;importÂ org.springframework.core.MethodParameter;importÂ org.springframework.http.MediaType;importÂ org.springframework.http.ResponseEntity;importÂ org.springframework.http.converter.HttpMessageConverter;importÂ org.springframework.http.server.ServerHttpRequest;importÂ org.springframework.http.server.ServerHttpResponse;importÂ org.springframework.web.bind.annotation.ControllerAdvice;importÂ org.springframework.web.servlet.mvc.method.annotation.ResponseBodyAdvice;importÂ sun.reflect.generics.reflectiveObjects.ParameterizedTypeImpl;importÂ xyz.hlh.crypto.annotation.EncryptionAnnotation;importÂ xyz.hlh.crypto.common.entity.Result;importÂ xyz.hlh.crypto.common.exception.CryptoException;importÂ xyz.hlh.crypto.entity.RequestBase;importÂ xyz.hlh.crypto.util.AESUtil;importÂ java.lang.reflect.Type;/**Â *Â @authorÂ HLHÂ *Â @description:Â *Â @emailÂ 17703595860@163.comÂ *Â @dateÂ :Â CreatedÂ inÂ 2022/2/4Â 15:12Â */@ControllerAdvicepublicÂ classÂ EncryptResponseBodyAdviceÂ implementsÂ ResponseBodyAdvice<Result<?>>Â {Â Â Â Â @AutowiredÂ Â Â Â privateÂ ObjectMapperÂ objectMapper;Â Â Â Â @OverrideÂ Â Â Â publicÂ booleanÂ supports(MethodParameterÂ returnType,Â Class<?Â extendsÂ HttpMessageConverter<?>>Â converterType)Â {Â Â Â Â Â Â Â Â ParameterizedTypeImplÂ genericParameterTypeÂ =Â (ParameterizedTypeImpl)returnType.getGenericParameterType();Â Â Â Â Â Â Â Â //Â å¦‚æœç›´æ¥æ˜¯Resultï¼Œåˆ™è¿”å›Â Â Â Â Â Â Â Â ifÂ (genericParameterType.getRawType()Â ==Â Result.classÂ &&Â returnType.hasMethodAnnotation(EncryptionAnnotation.class))Â {Â Â Â Â Â Â Â Â Â Â Â Â returnÂ true;Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â ifÂ (genericParameterType.getRawType()Â !=Â ResponseEntity.class)Â {Â Â Â Â Â Â Â Â Â Â Â Â returnÂ false;Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â //Â å¦‚æœæ˜¯ResponseEntity<Result>Â Â Â Â Â Â Â Â forÂ (TypeÂ typeÂ :Â genericParameterType.getActualTypeArguments())Â {Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (((ParameterizedTypeImpl)Â type).getRawType()Â ==Â Result.classÂ &&Â returnType.hasMethodAnnotation(EncryptionAnnotation.class))Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ true;Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â returnÂ false;Â Â Â Â }Â Â Â Â @SneakyThrowsÂ Â Â Â @OverrideÂ Â Â Â publicÂ Result<?>Â beforeBodyWrite(Result<?>Â body,Â MethodParameterÂ returnType,Â MediaTypeÂ selectedContentType,Â Class<?Â extendsÂ HttpMessageConverter<?>>Â selectedConverterType,Â ServerHttpRequestÂ request,Â ServerHttpResponseÂ response)Â {Â Â Â Â Â Â Â Â //Â åŠ å¯†Â Â Â Â Â Â Â Â ObjectÂ dataÂ =Â body.getData();Â Â Â Â Â Â Â Â //Â å¦‚æœdataä¸ºç©ºï¼Œç›´æ¥è¿”å›Â Â Â Â Â Â Â Â ifÂ (dataÂ ==Â null)Â {Â Â Â Â Â Â Â Â Â Â Â Â returnÂ body;Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â //Â å¦‚æœæ˜¯å®ä½“ï¼Œå¹¶ä¸”ç»§æ‰¿äº†Requestï¼Œåˆ™æ”¾å…¥æ—¶é—´æˆ³Â Â Â Â Â Â Â Â ifÂ (dataÂ instanceofÂ RequestBase)Â {Â Â Â Â Â Â Â Â Â Â Â Â ((RequestBase)data).setCurrentTimeMillis(System.currentTimeMillis());Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â StringÂ dataTextÂ =Â JSONUtil.toJsonStr(data);Â Â Â Â Â Â Â Â //Â å¦‚æœdataä¸ºç©ºï¼Œç›´æ¥è¿”å›Â Â Â Â Â Â Â Â ifÂ (StringUtils.isBlank(dataText))Â {Â Â Â Â Â Â Â Â Â Â Â Â returnÂ body;Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â //Â å¦‚æœä½æ•°å°äº16ï¼ŒæŠ¥é”™Â Â Â Â Â Â Â Â ifÂ (dataText.length()Â <Â 16)Â {Â Â Â Â Â Â Â Â Â Â Â Â throwÂ newÂ CryptoException("åŠ å¯†å¤±è´¥ï¼Œæ•°æ®å°äº16ä½");Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â StringÂ encryptTextÂ =Â AESUtil.encryptHex(dataText);Â Â Â Â Â Â Â Â returnÂ Result.builder()Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .status(body.getStatus())Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .data(encryptText)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .message(body.getMessage())Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build();Â Â Â Â }}
```

### [5.4 crypto-test](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

#### [5.4.1 ç»“æ„](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_png/6mychickmupVtnUCQDopBzY25pc0E8ge6HWl0BbEld7GuPuOibz3O6l25DBKXibexT4wCeiaSCpJb1OspPhkicUnPBw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

5.4.2 é‡è¦ä»£ç 

application.yml é…ç½®æ–‡ä»¶

```
spring:<br style="outline: 0px;">Â Â mvc:<br style="outline: 0px;">Â Â Â Â format:<br style="outline: 0px;">Â Â Â Â Â Â date-time:Â yyyy-MM-ddÂ HH:mm:ss<br style="outline: 0px;">Â Â Â Â Â Â date:Â yyyy-MM-dd<br style="outline: 0px;">Â Â #Â æ—¥æœŸæ ¼å¼åŒ–<br style="outline: 0px;">Â Â jackson:<br style="outline: 0px;">Â Â Â Â date-format:Â yyyy-MM-ddÂ HH:mm:ss<br style="outline: 0px;">
```

Teacher å®ä½“ç±»

```
packageÂ xyz.hlh.crypto.entity;importÂ lombok.AllArgsConstructor;importÂ lombok.Data;importÂ lombok.EqualsAndHashCode;importÂ lombok.NoArgsConstructor;importÂ org.hibernate.validator.constraints.Range;importÂ javax.validation.constraints.NotBlank;importÂ javax.validation.constraints.NotNull;importÂ java.io.Serializable;importÂ java.util.Date;/**Â *Â @authorÂ HLHÂ *Â @description:Â Teacherå®ä½“ç±»ï¼Œä½¿ç”¨SpringBootçš„validationæ ¡éªŒÂ *Â @emailÂ 17703595860@163.comÂ *Â @dateÂ :Â CreatedÂ inÂ 2022/2/4Â 10:21Â */@Data@NoArgsConstructor@AllArgsConstructor@EqualsAndHashCode(callSuperÂ =Â true)publicÂ classÂ TeacherÂ extendsÂ RequestBaseÂ implementsÂ SerializableÂ {Â Â Â Â @NotBlank(messageÂ =Â "å§“åä¸èƒ½ä¸ºç©º")Â Â Â Â privateÂ StringÂ name;Â Â Â Â @NotNull(messageÂ =Â "å¹´é¾„ä¸èƒ½ä¸ºç©º")Â Â Â Â @Range(minÂ =Â 0,Â maxÂ =Â 150,Â messageÂ =Â "å¹´é¾„ä¸åˆæ³•")Â Â Â Â privateÂ IntegerÂ age;Â Â Â Â @NotNull(messageÂ =Â "ç”Ÿæ—¥ä¸èƒ½ä¸ºç©º")Â Â Â Â privateÂ DateÂ birthday;}
```

TestController æµ‹è¯• Controller

```
packageÂ xyz.hlh.crypto.controller;importÂ org.springframework.http.ResponseEntity;importÂ org.springframework.validation.annotation.Validated;importÂ org.springframework.web.bind.annotation.PostMapping;importÂ org.springframework.web.bind.annotation.RequestBody;importÂ org.springframework.web.bind.annotation.RestController;importÂ xyz.hlh.crypto.annotation.DecryptionAnnotation;importÂ xyz.hlh.crypto.annotation.EncryptionAnnotation;importÂ xyz.hlh.crypto.common.entity.Result;importÂ xyz.hlh.crypto.common.entity.ResultBuilder;importÂ xyz.hlh.crypto.entity.Teacher;/**Â *Â @authorÂ HLHÂ *Â @description:Â æµ‹è¯•ControllerÂ *Â @emailÂ 17703595860@163.comÂ *Â @dateÂ :Â CreatedÂ inÂ 2022/2/4Â 9:16Â */@RestControllerpublicÂ classÂ TestControllerÂ implementsÂ ResultBuilderÂ {Â Â Â Â /**Â Â Â Â Â *Â ç›´æ¥è¿”å›å¯¹è±¡ï¼Œä¸åŠ å¯†Â Â Â Â Â *Â @paramÂ teacherÂ Teacherå¯¹è±¡Â Â Â Â Â *Â @returnÂ ä¸åŠ å¯†çš„å¯¹è±¡Â Â Â Â Â */Â Â Â Â @PostMapping("/get")Â Â Â Â publicÂ ResponseEntity<Result<?>>Â get(@ValidatedÂ @RequestBodyÂ TeacherÂ teacher)Â {Â Â Â Â Â Â Â Â returnÂ success(teacher);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â è¿”å›åŠ å¯†åçš„æ•°æ®Â Â Â Â Â *Â @paramÂ teacherÂ Teacherå¯¹è±¡Â Â Â Â Â *Â @returnÂ è¿”å›åŠ å¯†åçš„æ•°æ®Â ResponseBody<Result>æ ¼å¼Â Â Â Â Â */Â Â Â Â @PostMapping("/encrypt")Â Â Â Â @EncryptionAnnotationÂ Â Â Â publicÂ ResponseEntity<Result<?>>Â encrypt(@ValidatedÂ @RequestBodyÂ TeacherÂ teacher)Â {Â Â Â Â Â Â Â Â returnÂ success(teacher);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â è¿”å›åŠ å¯†åçš„æ•°æ®Â Â Â Â Â *Â @paramÂ teacherÂ Teacherå¯¹è±¡Â Â Â Â Â *Â @returnÂ è¿”å›åŠ å¯†åçš„æ•°æ®Â Resultæ ¼å¼Â Â Â Â Â */Â Â Â Â @PostMapping("/encrypt1")Â Â Â Â @EncryptionAnnotationÂ Â Â Â publicÂ Result<?>Â encrypt1(@ValidatedÂ @RequestBodyÂ TeacherÂ teacher)Â {Â Â Â Â Â Â Â Â returnÂ success(teacher).getBody();Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â è¿”å›è§£å¯†åçš„æ•°æ®Â Â Â Â Â *Â @paramÂ teacherÂ Teacherå¯¹è±¡Â Â Â Â Â *Â @returnÂ è¿”å›è§£å¯†åçš„æ•°æ®Â Â Â Â Â */Â Â Â Â @PostMapping("/decrypt")Â Â Â Â @DecryptionAnnotationÂ Â Â Â publicÂ ResponseEntity<Result<?>>Â decrypt(@ValidatedÂ @RequestBodyÂ TeacherÂ teacher)Â {Â Â Â Â Â Â Â Â returnÂ success(teacher);Â Â Â Â }}
```

* * *

æ¬¢è¿åŠ å…¥æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒï¼Œå…¨é¢æå‡æŠ€æœ¯èƒ½åŠ›ã€‚

ğŸ‘‰Â åŠ å…¥æ–¹å¼ï¼Œ**â€œ**é•¿æŒ‰**â€ æˆ– â€œ**æ‰«æ**â€ ä¸‹æ–¹äºŒç»´ç å™¢**ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/6mychickmupUyQRGCOLQlJYyS47picY3OzaoUUJvwwrgEyR5U5fcYrCggDvjuDmAtibib1Zf6JjXlOic1PfvRCF2l4A/640?wx_fmt=png)

æ˜Ÿçƒçš„**å†…å®¹åŒ…æ‹¬**ï¼šé¡¹ç›®å®æˆ˜ã€é¢è¯•æ‹›è˜ã€æºç è§£æã€å­¦ä¹ è·¯çº¿ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZfdWPYr0VKaXztEGHacpRyle64G451XsWx4Ufc9FHYmNTqFdKdtNhyjlhrEC7Pic1dRfue78ib3TiaKBg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZfdWPYr0VKaXztEGHacpRylewlfAU6nBKS8tWSIrLcmSicsq0ECUIVnf0JHibsLARrp4Z3ZCh5oSvYMQ/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZfdWPYr0VKaXztEGHacpRyleptHSrmBV71SbQSolzZpmdqN2q03yLwk1bwZYNu2lr17gFjO0rh1ZdQ/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZfdWPYr0VKaXztEGHacpRyleYQLfl6qLTABQx5UrP0dXXv6cSv2TmBoouiciaZIXwyD88h5OIsM8lpkw/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZfdWPYr0VKaXztEGHacpRyleicAvrkTkdGYRubqZdPNkqpoTmtOCQjkItotwtAbCxibsWUI4Dz0ILTEg/640?wx_fmt=png)

```
æ–‡ç« æœ‰å¸®åŠ©çš„è¯ï¼Œåœ¨çœ‹ï¼Œè½¬å‘å§ã€‚

è°¢è°¢æ”¯æŒå“Ÿ (*^__^*ï¼‰

```